import os
import hashlib
import logging
from colorama import Fore, Style

# Predefined malware signatures (hashes of known malware files)
MALWARE_SIGNATURES = {                                                                                                    
    "EICAR_Test_File": "275a021bbfb648aa3206d6e4d8c662c7e542c1686c5b167b2f832d83b1455a4f",  # EICAR test file hash
}

# Setup logging
logging.basicConfig(filename='malware_scan.log', level=logging.INFO, format='%(asctime)s - %(message)s')

def get_file_hash(file_path):
    """Generate SHA-256 hash of a file."""
    hasher = hashlib.sha256()
    try:
        with open(file_path, "rb") as file:
            while chunk := file.read(8192):
                hasher.update(chunk)
        return hasher.hexdigest()
    except OSError as e:
        print(Fore.RED + f"Error reading file {file_path}: {e}" + Style.RESET_ALL)
        return None

def log_scan_result(file_path, message):
    """Log scan result to a file."""
    logging.info(f"{file_path}: {message}")

def scan_file(file_path):
    """Scan a file for known malware signatures."""
    if not os.path.isfile(file_path):
        print(Fore.RED + f"File '{file_path}' does not exist." + Style.RESET_ALL)
        return

    file_hash = get_file_hash(file_path)
    if not file_hash:
        return

    for malware_name, signature in MALWARE_SIGNATURES.items():
        if file_hash == signature:
            print(Fore.RED + f"Alert! File '{file_path}' matches malware signature: {malware_name}" + Style.RESET_ALL)
            log_scan_result(file_path, f"Malware found: {malware_name}")
            return

    print(Fore.GREEN + f"File '{file_path}' is clean." + Style.RESET_ALL)
    log_scan_result(file_path, "Clean")

def scan_directory(directory_path):
    """Scan all files in a directory recursively."""
    if not os.path.isdir(directory_path):
        print(Fore.RED + f"Directory '{directory_path}' does not exist." + Style.RESET_ALL)
        return

    for root, dirs, files in os.walk(directory_path):
        for file in files:
            file_path = os.path.join(root, file)
            scan_file(file_path)

def main():
    print("Simple Malware Scanner")
    choice = input("1: Scan a file, 2: Scan a directory: ")
    if choice == "1":
        file_path = input("Enter the path of the file to scan: ")
        scan_file(file_path)
    elif choice == "2":
        directory_path = input("Enter the directory path to scan: ")
        scan_directory(directory_path)
    else:
        print("Invalid choice")

if __name__ == "__main__":
    main()
